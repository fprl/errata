---
title: The Registry
description: Define codes, details, messages, and metadata.
---

## On this page
- Structure
- Details with props
- Messages
- Metadata and defaults
- Tags

## Structure

Use `defineCodes` to declare codes as flat strings or nested objects (flattened to dot-notation).

```ts
import { code, defineCodes, errata, props } from 'errata'

export const errors = errata({
  codes: defineCodes({
    core: {
      internal_error: { status: 500, message: 'Internal error', tags: ['core'] },
    },
    auth: {
      invalid_credentials: code({
        status: 401,
        message: 'Invalid credentials',
        tags: ['auth', 'login'] as const,
        details: props<{ email: string }>(),
      }),
    },
    billing: {
      payment_failed: code({
        status: 402,
        message: ({ details }) => `Payment failed for ${details.provider}`,
        tags: ['payments'] as const,
        details: props<{ provider: 'stripe' | 'adyen', amount: number }>(),
      }),
    },
  }),
})
```

## Details with props

- `props<T>()`: required at call-site, typed as `T`.
- `props(defaults)`: optional at call-site; defaults are applied at runtime.

```ts
rate_limited: code({
  status: 429,
  message: ({ details }) => `Retry after ${details.retryAfter}s`,
  details: props({ retryAfter: 60 }), // call-site optional
})

not_found: code({
  message: ({ details }) => `User ${details.id} not found`,
  details: props<{ id: string }>(), // call-site required
})
```

## Messages

Use a string or a resolver:

```ts
{ message: 'Invalid token' }
{ message: ({ details }) => `Invalid credentials for ${details.email}` }
```

Resolvers run at creation; serialization keeps the resolved message (re-resolves if missing).

## Metadata and defaults

You can set defaults in `errata({ defaultStatus, defaultExpose, defaultRetryable })` and override per code:

- `status`: number (HTTP or exit code).
- `expose`: whether `details` survive `serialize`.
- `retryable`: hint for callers; no retries are performed.
- `logLevel`: `debug | info | warn | error | fatal` (advisory).

```ts
export const errors = errata({
  defaultStatus: 500,
  defaultExpose: false,
  defaultRetryable: false,
  codes: defineCodes({
    core: {
      internal_error: { message: 'Internal error' },
    },
    billing: {
      payment_failed: code({
        status: 402,
        retryable: true,
        expose: true,
        message: ({ details }) => `Payment failed for ${details.provider}`,
        details: props<{ provider: 'stripe' | 'adyen', amount: number }>(),
      }),
    },
  }),
})
```

## Tags

Tags are free-form strings. Use `as const` to let `hasTag` narrow the code union.

```ts
auth_error: code({
  message: 'Auth issue',
  tags: ['auth', 'security'] as const,
})

// Later
if (errors.hasTag(err, 'security')) {
  alertSecurityTeam(err)
}
```
