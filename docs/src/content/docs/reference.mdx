---
title: API Reference
description: Methods, hooks, and types at a glance.
---

## Instance methods

| Method | Description |
| :--- | :--- |
| `create(code, details?)` | Create a typed `ErrataError`; applies defaults and resolves message. |
| `ensure(err, fallbackCode?)` | Normalize unknowns into `ErrataError`, honoring plugins/onUnknown. |
| `safe(promiseOrFn)` | Returns a typed tuple `[data, error]` without try/catch. |
| `is(err, pattern | pattern[])` | Pattern-aware guard; supports wildcards (`'auth.*'`) and arrays. |
| `match(err, handlers)` | Picks exact > longest wildcard > `default`; returns handler result. |
| `hasTag(err, tag)` | Tag guard; narrows to codes carrying that tag. |
| `serialize(err)` | Branded payload; strips `details` when `expose` is false. |
| `deserialize(json)` | Rehydrates an `ErrataError`; re-resolves message if missing. |
| `http.from(err, fallback?)` | `{ status, body: { error } }` helper (uses `serialize`). |

## Options (errata)

- `app?`, `env?`: identifiers; `env` stays server-side unless a plugin adds it.
- `defaultStatus`, `defaultExpose`, `defaultRetryable`: per-code defaults.
- `codes`: required registry (use `defineCodes`).
- `plugins?`: optional; merged after your codes.
- `allowPluginOverride?`: allow plugins to override existing codes (default `false`; collisions throw).
- `onUnknown?(error, ctx)`: map unknown inputs; return a code or `null`.
- `captureStack?`: controls stack capture (defaults to `true`).

## Plugin hooks

- `codes`: inject codes (warns on collisions).
- `onUnknown(error, ctx)`: map third-party errors; first non-null wins.
- `onCreate(error, ctx)`: side effects on creation (all plugins run).
- `onSerialize(payload, error, ctx)`: scrub/enrich serialized payload.

## Client surface (`createErrataClient<typeof errors>()`)

- Methods: `deserialize`, `ensure`, `is`, `match`, `hasTag`, `safe`.
- Uses the same code/detail unions as the server type; no registry shipped.
- Supports client plugins: `onDeserialize`, `onCreate`.

## Client options

- `app?`: app identifier for logging/observability.
- `plugins?`: client plugins for payload adaptation and side effects.
- `strict?`: require branded payloads (`__brand`, `code`, `message`) for builtâ€‘in deserialization.
- `onUnknown?(error, ctx)`: map unknown inputs; return a code or `null`.

## Types and helpers

- `ErrataError`, `ErrataClientError`, `SerializedError`.
- `CodesOf<typeof errors>`: extract code union from an instance.
- `PatternInput`, `PatternInputForCodes`: accepted patterns for `is`.
- `PatternForCodes`: patterns for `match` handlers (includes wildcards).
- `props<T>()` vs `props(defaults)`: required vs optional-with-defaults details.
